apply plugin: "application"

apply from: "$project.rootDir/buildScripts/java.gradle"
apply from: "$project.rootDir/buildScripts/kotlin.gradle"
apply from: "$project.rootDir/buildScripts/testing.gradle"
apply from: "$project.rootDir/buildScripts/packaging.gradle"

application {
    mainClassName = 'kr.flab.wiki.app.MainKt'
}

sourceSets {
    def buildConfig = getBuildConfig()

    main {
        java {
            srcDirs srcDirs = [srcDirs, "src/$buildConfig/java", "src/$buildConfig/kotlin"]
        }

        resources {
            srcDirs srcDirs = [srcDirs, "src/$buildConfig/resources"]
        }
    }
}

dependencies {
    implementation project(":app-core")
    implementation project(":app-lib")

    testImplementation project(path: ":app-core", configuration: "testArtifacts")
    testImplementation project(path: ":app-lib", configuration: "testArtifacts")
}

jar {
    manifest {
        attributes "Main-Class": "kr.flab.wiki.app.MainKt"
    }

    from {
        configurations.compileClasspath.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
}

versioning {

    def buildConfig = getBuildConfig()

    if(buildConfig == "release"){
        ("git tag ${project.version.toString()}").execute()
    }
}
